(()=>{var s=(e,r,n)=>new Promise((t,o)=>{var i=l=>{try{d(n.next(l))}catch(a){o(a)}},u=l=>{try{d(n.throw(l))}catch(a){o(a)}},d=l=>l.done?t(l.value):Promise.resolve(l.value).then(i,u);d((n=n.apply(e,r)).next())});function D(){window.onscroll=()=>{let e=[[document.getElementById("page-header"),"sticky-shadow-header"],[document.getElementById("page-footer"),"sticky-shadow-footer"]],r=document.body.scrollTop>0||document.documentElement.scrollTop>0;e.forEach(([n,t])=>n.classList[r?"add":"remove"](t))}}function F(){let r="JOURNAL-2025-theme",n=document.querySelector(".theme-toggler"),t=document.querySelector(".light"),o=document.querySelector(".dark"),i=n.querySelector(".light .visually-hidden"),u=n.querySelector(".dark .visually-hidden"),d=n.querySelector("button");function l(){try{let g=localStorage.getItem(r);return g?JSON.parse(g):!1}catch(g){return console.error("Error parsing theme from localStorage:",g),!1}}let a=l();function c(g){a=g,document.documentElement.classList.toggle("darkmode",a),localStorage.setItem(r,a),f()}function m(){c(!a)}function f(){i.textContent=a?" theme inactive":" theme active",u.textContent=a?" theme active":" theme inactive";let g=i.textContent,b=u.textContent;S(g,t),S(b,o),d.setAttribute("aria-pressed",a?"false":"true")}function S(g,b){g===" theme active"?b.classList.add("underline"):b.classList.remove("underline")}d.addEventListener("click",m),c(a)}function O(){let e=document.getElementById("loader"),r=document.getElementById("page-loaded");window.addEventListener("load",()=>{r.textContent="Page has loaded.",requestAnimationFrame(()=>{e.classList.add("loader-hidden")})})}function Y(e="Working\u2026"){let r=document.getElementById("loader"),n=document.getElementById("page-loaded");if(!r)return;let t=r.querySelector(".visually-hidden");t&&(t.textContent=e),n&&(n.textContent=e),r.classList.remove("loader-hidden")}function R(e="Done."){let r=document.getElementById("loader"),n=document.getElementById("page-loaded");if(!r)return;let t=r.querySelector(".visually-hidden");t&&(t.textContent=e),n&&(n.textContent=e),requestAnimationFrame(()=>{r.classList.add("loader-hidden")})}function q(){let e=document.querySelector("html"),r=document.querySelector(".header");new ResizeObserver(t=>{for(let o of t){let i=getComputedStyle(o.target),u=getComputedStyle(e),d=parseFloat(i.paddingBlockStart),l=parseFloat(i.paddingBlockEnd),a=d+l,c=parseFloat(u.getPropertyValue("--skip-link-gap"))||0,m=a+c,f=(o.contentRect.height+m)/16;e.style=`scroll-padding-top: ${f}rem`}}).observe(r)}function p(e,r){for(let[n,t]of Object.entries(r))t==null?e.removeAttribute(n):e.setAttribute(n,t)}var te="Enter a title...",re="Enter some text...",ne="Enter alt text...";function N(e,r,n){e.getAttribute("placeholder")===""&&e.setAttribute("placeholder",te),r.getAttribute("placeholder")===""&&r.setAttribute("placeholder",re),n&&n.getAttribute("placeholder")===""&&n.setAttribute("placeholder",ne)}function w(e,r,n){e.setAttribute("required",""),r.setAttribute("required",""),n.setAttribute("required","")}function V(e,r){e.date.value=r,e.heading.value="",e.text.value="",e.image.input.value="",e.image.altText.value="",e.image.wrapper.classList.add("hide")}function X(e){e.charCounter.textContent="0/150",e.charLimit.textContent="",e.cancelButton.setAttribute("disabled","")}function L(e,r){V(e,r),X(e.image),e.form.classList.add("hide"),e.buttons.create.removeAttribute("disabled")}function U(e){e.wrapper.classList.remove("hide"),e.cancelButton.removeAttribute("disabled")}function H(e){e.input.value="",e.wrapper.classList.add("hide"),e.altText.value="",e.charCounter.textContent="0/150",e.charLimit.textContent="",e.cancelButton.setAttribute("disabled","")}function P(e,r,n){let t=e.value.length;r.textContent=`${t}/150`,n.textContent=t===150?"No more characters allowed!":""}function K(e){let r=(e==null?void 0:e.name)||"",n=(e==null?void 0:e.message)||"";if(r==="QuotaExceededError"||r==="NS_ERROR_DOM_QUOTA_REACHED"||n.includes("QUOTA")||n.includes("disk is full")){alert(`
Your browser's storage is full.

Try:
\u2022 Deleting large images
\u2022 Removing older entries
\u2022 Exporting entries to JSON, then clearing the journal

(IndexedDB does not have unlimited space on your device.)
    `);return}console.error(e),alert("A storage error occurred. See console for details.")}function v(e){return s(this,null,function*(){try{return yield e()}catch(r){throw K(r),r}})}var oe="journal2025",h="entries",ae=1,T;function B(){return new Promise((e,r)=>{if(T)return e(T);let n=indexedDB.open(oe,ae);n.onerror=()=>r(n.error),n.onsuccess=()=>{T=n.result,e(T)},n.onupgradeneeded=t=>{let o=t.target.result;o.objectStoreNames.contains(h)||o.createObjectStore(h,{keyPath:"id"})}})}function J(e){return v(()=>s(null,null,function*(){let n=(yield B()).transaction(h,"readwrite");return n.objectStore(h).put(e),new Promise((t,o)=>{n.oncomplete=()=>t(),n.onerror=()=>o(n.error)})}))}function x(){return v(()=>s(null,null,function*(){let t=(yield B()).transaction(h,"readonly").objectStore(h).getAll();return new Promise((o,i)=>{t.onsuccess=()=>o(t.result),t.onerror=()=>i(t.error)})}))}function C(e){return J(e)}function Z(e){return v(()=>s(null,null,function*(){let n=(yield B()).transaction(h,"readwrite");return n.objectStore(h).delete(e),new Promise((t,o)=>{n.oncomplete=()=>t(),n.onerror=()=>o(n.error)})}))}function ee(){return v(()=>s(null,null,function*(){let r=(yield B()).transaction(h,"readwrite");return r.objectStore(h).clear(),new Promise((n,t)=>{r.oncomplete=()=>n(),r.onerror=()=>t(r.error)})}))}function M({addEntry:e,updateExportButton:r}={}){let n=new Date().toISOString().split("T")[0],t={form:document.getElementById("journal-form"),heading:document.getElementById("journal-heading"),text:document.getElementById("journal-text"),date:document.getElementById("journal-entry-date"),image:{input:document.getElementById("image-input"),wrapper:document.getElementById("alt-text-wrapper"),altText:document.getElementById("image-alt"),charCounter:document.getElementById("character-count"),charLimit:document.getElementById("character-limit-message"),cancelButton:document.querySelector("[data-cancel-image-upload-button]"),fileBlob:null,fileType:null},buttons:{create:document.getElementById("create-entry"),cancel:document.getElementById("cancel")}};t.date.value=n,t.image.altText.value="",t.image.altText.addEventListener("input",()=>{P(t.image.altText,t.image.charCounter,t.image.charLimit)}),t.buttons.create.addEventListener("click",o=>{o.target.setAttribute("disabled","true"),t.form.classList.remove("hide"),p(t.form,{role:"region",tabindex:"-1","aria-label":"Journal entry form"}),t.form.focus(),t.form.classList.add("focus-highlight"),setTimeout(()=>{t.form.classList.remove("focus-highlight"),p(t.form,{role:null,tabindex:null,"aria-label":null})},2e3),w(t.date,t.heading,t.text)}),t.buttons.cancel.addEventListener("click",()=>{L(t,n),t.image.fileBlob=null,t.image.fileType=null}),t.image.input.addEventListener("change",o=>{if(o.target.files&&o.target.files.length>0){let i=o.target.files[0];t.image.fileBlob=i,t.image.fileType=i.type,U(t.image)}}),t.image.cancelButton.addEventListener("click",()=>{H(t.image),t.image.fileBlob=null,t.image.fileType=null}),t.form.addEventListener("submit",o=>s(null,null,function*(){o.preventDefault(),N(t.heading,t.text,t.image.altText);let i={date:t.date.value.split("-").reverse().join("/"),heading:t.heading.value,text:t.text.value,edited:!1,id:new Date().valueOf().toString(),imageAlt:t.image.altText.value||"",imageBlob:t.image.fileBlob||null,imageType:t.image.fileType||null};try{yield J(i)}catch(u){console.error("Failed to save entry to IndexedDB",u)}e(i),r&&r(),L(t,n),t.image.fileBlob=null,t.image.fileType=null}))}function _(e){e.addEventListener("keydown",r=>{if(r.key!=="Enter")return;r.preventDefault();let n=window.getSelection();if(!n.rangeCount)return;let t=n.getRangeAt(0);t.deleteContents();let o=document.createElement("br");t.insertNode(o),t.setStartAfter(o),t.setEndAfter(o),n.removeAllRanges(),n.addRange(t)}),e.addEventListener("paste",r=>{r.preventDefault();let t=r.clipboardData.getData("text/plain").split(/\r?\n/),o=window.getSelection(),i=o.getRangeAt(0);i.deleteContents(),t.forEach((u,d)=>{d>0&&(i.insertNode(document.createElement("br")),i.collapse(!1)),i.insertNode(document.createTextNode(u)),i.collapse(!1)}),o.removeAllRanges(),o.addRange(i)})}function E(e,r,n){if(!r||!n||!e)return;let t=r.content.cloneNode(!0),o=t.querySelector("li"),i=t.querySelector("[data-journal-heading]"),u=t.querySelector("[data-journal-text]"),d=t.querySelector("[data-journal-date]"),l=t.querySelector("[data-journal-image-wrapper]");if(p(o,{"data-entry-id":e.id,class:"journal-item"}),i&&(i.textContent=e.heading),u&&(u.textContent=e.text),d&&(d.textContent=e.date),u.innerHTML=e.text.replace(/\n/g,"<br>"),_(u),e.imageBlob){l.innerHTML="",l.classList.add("journal-image-wrapper");let a=document.createElement("img");a.classList.add("lazy-loaded-image","lazy"),a.setAttribute("alt",e.imageAlt||"");let c=URL.createObjectURL(e.imageBlob);a.dataset.src=c,a.src=c,a.onload=()=>{p(a,{width:a.naturalWidth,height:a.naturalHeight})};let m=new MutationObserver(S=>{S.forEach(g=>{g.removedNodes.forEach(b=>{b===a&&(URL.revokeObjectURL(c),m.disconnect())})})});m.observe(l,{childList:!0}),l.appendChild(a);let f=document.createElement("button");f.dataset.removeImageButton="",f.className="remove-image-button",f.textContent="Delete image",l.appendChild(f)}else l.innerHTML="";n.prepend(t)}function j(e,r,n,t){e.toggleAttribute("contenteditable");let o=n.find(i=>i.id===r.dataset.entryId);o.edited=!e.hasAttribute("contenteditable"),o.edited&&(o[t]=e.innerHTML.replace(/<br\s*\/?>/gi,`
`).trim())}function I(e){let r=e.target;r.textContent=r.textContent==="Edit"?"Save":"Edit",r.classList.toggle("edit-button"),r.classList.toggle("save-edit-button")}function z(e,r,n){let t=r.querySelector("[data-journal-text]");j(t,r,n,"text"),I(e)}function $(e,r,n){let t=r.querySelector("[data-journal-heading]");t.addEventListener("keydown",o=>{o.key==="Enter"&&o.preventDefault()}),j(t,r,n,"heading"),I(e)}function y(e){let r=document.getElementById("delete-all-entries");r&&(e.length>1?r.removeAttribute("disabled"):r.setAttribute("disabled",""))}function k(e){let r=[].slice.call(e.querySelectorAll(".lazy-loaded-image.lazy")),n=new IntersectionObserver(function(t){t.forEach(function(o){if(o.isIntersecting){let i=o.target;i.src=i.dataset.src,i.classList.remove("lazy"),n.unobserve(i)}})});r.forEach(function(t){n.observe(t)})}function G({entries:e=[],updateExportButton:r}={}){let n=document.getElementById("journal-form"),t=document.getElementById("journal-item-template"),o=document.createElement("ul"),i=document.getElementById("delete-all-entries");p(o,{class:"journal-list",id:"journal-list"}),n.after(o),e.forEach(d=>E(d,t,o)),y(e),r&&r(),k(o);function u(d){e.push(d),E(d,t,o),k(o),y(e),r&&r();let l=o.firstElementChild;if(l){p(l,{role:"status","aria-live":"polite",tabindex:"-1"}),l.focus(),l.classList.add("focus-highlight"),setTimeout(()=>l.classList.remove("focus-highlight"),2e3);let a=l.nextElementSibling;a&&p(a,{role:null,"aria-live":null,tabindex:null})}}return o.addEventListener("click",d=>s(null,null,function*(){let l=d.target.closest(".journal-item");if(!l)return;let a=e.find(c=>c.id===l.dataset.entryId);if(d.target.matches("[data-button-heading-edit]")){if($(d,l,e),a)try{yield C(a)}catch(c){console.error("Failed to update entry",c)}y(e),r&&r();return}if(d.target.matches("[data-button-text-edit]")){if(z(d,l,e),a)try{yield C(a)}catch(c){console.error("Failed to update entry",c)}y(e),r&&r();return}if(d.target.matches("[data-remove-image-button]")){if(!confirm("Are you sure you want to delete the image?"))return;let c=l.querySelector("[data-journal-image-wrapper]");if(c&&(c.innerHTML=""),a){a.imageBlob=null,a.imageType=null,a.imageAlt="";try{yield C(a)}catch(m){console.error("Failed to remove image in DB",m)}}y(e),r&&r();return}if(d.target.matches("[data-button-journal-delete]")){if(!confirm("Are you sure you want to delete this entry?"))return;l.remove();let c=l.dataset.entryId,m=e.findIndex(f=>f.id===c);m>-1&&e.splice(m,1);try{yield Z(c)}catch(f){console.error("Failed to delete entry from DB",f)}y(e),r&&r();return}})),i.addEventListener("click",()=>s(null,null,function*(){if(confirm("Delete ALL entries? This cannot be undone.")){try{yield ee()}catch(d){console.error("Failed to clear DB",d)}e.length=0,o.innerHTML="",y(e),r&&r()}})),{addEntry:u}}function A(e){return String(e).padStart(2,"0")}function ie(e){return{dateString:`${e.getUTCFullYear()}-${A(e.getUTCMonth()+1)}-${A(e.getUTCDate())}`,timeString:`${A(e.getUTCHours())}-${A(e.getUTCMinutes())}-${A(e.getUTCSeconds())}`}}function le(e){return s(this,null,function*(){if(!e)return null;let r=yield e.arrayBuffer(),n="",t=new Uint8Array(r),o=t.byteLength;for(let i=0;i<o;i++)n+=String.fromCharCode(t[i]);return btoa(n)})}function de(e,r){return s(this,null,function*(){try{let t=yield(yield window.showSaveFilePicker({suggestedName:r,types:[{description:"JSON file",accept:{"application/json":[".json"]}}]})).createWritable();return yield t.write(e),yield t.close(),!0}catch(n){if(n.name==="AbortError")return!0;throw n}})}function ce(e,r){let n=URL.createObjectURL(e),t=document.createElement("a");t.href=n,t.download=r,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(n)}function W(e="JOURNAL_2025-entries"){return s(this,null,function*(){let r;try{r=yield x()}catch(a){alert("Failed to read entries from the database"),console.error(a);return}if(!Array.isArray(r)||r.length===0){alert("No entries to export");return}let n=[];for(let a of r){let c={id:a.id,date:a.date,heading:a.heading,text:a.text,imageAlt:a.imageAlt||"",edited:a.edited||!1};if(a.imageBlob)try{let m=yield le(a.imageBlob);c.image={mime:a.imageType||"application/octet-stream",data:m}}catch(m){console.warn(`Failed to convert image for entry ${a.id}:`,m),c.image=null}else c.image=null;n.push(c)}let t=JSON.stringify(n,null,2),o=new Date,{dateString:i,timeString:u}=ie(o),d=`${e}-${i}_${u}.json`,l=new Blob([t],{type:"application/json"});if(window.showSaveFilePicker)try{yield de(l,d);return}catch(a){console.error("Failed using file picker, falling back:",a)}ce(l,d)})}function Q(){let e=document.getElementById("export-entries");if(!e)return{};function r(){return s(this,null,function*(){try{let n=yield x();Array.isArray(n)&&n.length>0?e.removeAttribute("disabled"):e.setAttribute("disabled","")}catch(n){console.error("Failed to check entries for export button",n),e.setAttribute("disabled","")}})}return e.addEventListener("click",()=>s(null,null,function*(){Y("Creating JSON file\u2026");try{yield W(),R("JSON file ready.")}catch(n){console.error("Export failed:",n),R("Failed to create JSON file."),alert("Export failed. See console for details.")}})),r(),{updateButtonState:r}}D();F();O();q();function se(){return s(this,null,function*(){if(!document.getElementById("journal-button-group"))return;let r=[];try{r=yield x()}catch(o){console.error("Failed to load entries from IndexedDB",o)}let{updateButtonState:n}=Q(),{addEntry:t}=G({entries:r,updateExportButton:n});M({addEntry:t,updateExportButton:n})})}se();})();
